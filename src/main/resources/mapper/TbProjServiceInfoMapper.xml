<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tuk.mina.dao.project.TbProjServiceInfoDao">

    <select id="getProjServiceInfo" resultType="TbProjServiceInfoVo">
        SELECT 
            *
        FROM TB_MINA_PROJ_SERVICE_INFO
        WHERE 1=1
        <if test="serviceId != null">
            AND serviceId = #{serviceId}
        </if>
        <if test="projectId != null">
            AND projectId = #{projectId}
        </if>
        <if test="serviceField != null and serviceField != ''">
            AND serviceField = #{serviceField}
        </if>
    </select>

    <select id="getServiceMasterList" resultType="TbProjServiceInfoVo">
        SELECT 
            serviceId,
            projectId,
            serviceField,
            fieldValue,
            createdUserId,
            createdDttm,
            updatedDttm
        FROM TB_MINA_PROJ_SERVICE_INFO
        WHERE projectId = 0
          AND serviceField = 'service_master'
        ORDER BY serviceId
    </select>

    <insert id="newProjServiceInfo" parameterType="TbProjServiceInfoVo">
        INSERT INTO TB_MINA_PROJ_SERVICE_INFO (
            serviceId,
            projectId,
            serviceField,
            fieldValue,
            createdUserId,
            createdDttm,
            updatedDttm
        ) VALUES (
            #{serviceId},
            #{projectId},
            #{serviceField},
            #{fieldValue},
            #{createdUserId},
            GETDATE(),
            GETDATE()
        )
    </insert>

    <update id="putProjServiceInfo" parameterType="TbProjServiceInfoVo">
        UPDATE TB_MINA_PROJ_SERVICE_INFO
        SET
            <if test="fieldValue != null">
                fieldValue = #{fieldValue},
            </if>
            updatedDttm = GETDATE()
        WHERE serviceId = #{serviceId}
          AND projectId = #{projectId}
          AND serviceField = #{serviceField}
    </update>

    <delete id="delProjServiceInfo" parameterType="TbProjServiceInfoVo">
        DELETE FROM TB_MINA_PROJ_SERVICE_INFO
        WHERE serviceId = #{serviceId}
          AND projectId = #{projectId}
          <if test="serviceField != null and serviceField != ''">
              AND serviceField = #{serviceField}
          </if>
    </delete>

</mapper>